# Next.js의 사전 렌더링 이해하기

### 사전 렌더링

브라우저의 요청에 사전에 렌더링이 완료된 HTML을 응답하는 렌더링 방식 

클라이언트 사이드 렌더링의 단점을 효율적으로 해결함

### 사전 렌더링 동작 방식

유저가 브라우저에 페이지를 요청하면 브라우저가 웹서버에 페이지를 요청하고 웹서버측은 자바스크립트로 작성해둔 모든 리액트 컴포넌트들을 다 실행해서 해당 컴포넌트들을 html 페이지로 미리 변환을 한 다음, 이 렌더링이 완료된 html 파일을 브라우저에게 응답해줌 

### 클라이언트 사이드 렌더링

React.js앱의 기본적인 렌더링 방식

브라우저가 리액트의 모든 자바스크립트 파일을 실행시켜 브라우저에서 직접 화면을 렌더링 하는 방식

유저가 브라우저에 페이지를 요청하면 브라우저가 웹서버에 페이지를 요청하고 웹서버측은 기본 틀만 존재하는 index.html을 브라우저에 전송 이후 지금까지 작성된 모든 js 파일(모든 리액트 파일)을 하나의 js 파일로 묶어서(bundling) 브라우저에 전송하고 브라우저는 js를 실행함.

이를 통해 페이지를 그리고 사용자에게 보여줌

장점

- 초기 접속 이후에 일어나는 페이지 이동이 매우 빠르고 쾌적함
    
    웹서버에서 전송하는 js bundle 파일에는 이 서비스에서 접근 가능한 모든 컴포넌트 코드가 존재
    
    따라서 초기 접속 후, 사용자가 새로운 페이지로 이동할 때 웹서버측에 새로운 페이지를 요청할 필요가 없음
    
    브라우저가 자체적으로 js를 실행시켜 사용자가 요청하는 컴포넌트를 실행시키면 됨
    
    → 빠른 속도로 쾌적하게 페이지를 이동시킬 수 있음
    

### 클라이언트 사이드 렌더링의 단점

→ 초기 접속 속도가 느림

사용자가 첫 화면을 보기까지 브라우저가 해야할 일이 너무 많음(index.html, js bundle 파일을 받아오고 해당 js를 실행시켜 컨텐츠를 렌더링 시켜야 함)

### FCP(First Contentful Paint)

요청 시작 시점으로부터 컨텐츠가 화면에 처음 나타나는데 걸리는 시간

요청 시작 ←→ 컨텐츠 렌더링

- 3sec 이상일 경우 : 이탈률 32% 증가
- 5sec 이상일 경우 : 이탈률 90% 증가
- 6sec 이상일 경우 : 이탈률 106% 증가
- 10sec 이상일 경우 : 이탈률 123% 증가

따라서 초기 렌더링이 너무 오래 걸리면 이탈률이 너무 높게 발생함

따라서 사전 렌더링을 통해 웹서버에서 js를 실행시켜 렌더링을 완료하고 렌더링된 htm l을 브라우저에 전송함

다만 이렇게 표시된 화면은 아직 사용자 인터렉션, 즉 상호작용이 불가능하다.

왜냐하면 아직 브라우저가 렌더링된 html 파일만을 받아 페인팅하여 표시했을 뿐이기 때문이다.

그럼 언제부터 상호작용이 가능한지?

→ 페이지가 화면에 표시된 후, 웹서버는 후속으로 모든 js파일을 js bundle 파일로 전송해준다.

그럼 브라우저는 js를 실행하여 현재 헨더링되어있는 html과 연결하여 상호작용을 구현한다.

### TTI(Time To Interactive)

- 상호작용까지 가능한 상태의 페이지가 되는 시점

### 이후 페이지 이동

- 클라이언트 사이드 렌더링 방식과 같은 방식으로 처리됨
    
    브라우저가 서버에게 별도의 페이지를 요청하지 않고 브라우저가 가지고있는 js 파일을 실행시켜(js bundle을 가지고 있으므로) 컴포넌트를 교체하는 방식으로 페이지를 교체한다.
    

최종적으로 

- 빠른 FCP 달성
- React의 장점인 빠른 페이지 이동 가능